package Vista;

import Controlador.ControladorUsuario;
import Modelo.DatabaseConnection;
import Modelo.RegistrarseDB;
import javax.swing.JOptionPane;
import Modelo.Usuarios;
import com.formdev.flatlaf.FlatClientProperties;
import com.formdev.flatlaf.FlatLightLaf;
import com.formdev.flatlaf.extras.FlatSVGIcon;
import java.awt.Color;
import javax.swing.ImageIcon;
import javax.swing.UIManager;
import org.mindrot.jbcrypt.BCrypt;

/**
 *
 * @author o.o
 */
public class PantallaRegistrarse extends javax.swing.JFrame {

    private RegistrarseDB pacienteModelo;

    /**
     * Creates new form PantallaRegistrarse
     */
    public PantallaRegistrarse() {

        setUndecorated(true);
        setIconImage(new ImageIcon(getClass().getResource("/SXP_Logo.png")).getImage());
        setLocationRelativeTo(null);

        initComponents();

        txtNombre.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Ingrese su Nombre");
        txtApellido.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Ingrese su Apellido");
        txtCorreo.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Ingrese su Email");
        txtTelefono.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Ingrese su Numero telefonico");
        txtCedula.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Ingrese su Cedula");
        Contraseña.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "Ingrese su contraseña");

        txtNombre.putClientProperty(FlatClientProperties.TEXT_FIELD_SHOW_CLEAR_BUTTON, true);
        txtApellido.putClientProperty(FlatClientProperties.TEXT_FIELD_SHOW_CLEAR_BUTTON, true);
        txtCorreo.putClientProperty(FlatClientProperties.TEXT_FIELD_SHOW_CLEAR_BUTTON, true);
        txtTelefono.putClientProperty(FlatClientProperties.TEXT_FIELD_SHOW_CLEAR_BUTTON, true);
        Contraseña.putClientProperty(FlatClientProperties.TEXT_FIELD_SHOW_CLEAR_BUTTON, true);

//        lblContraseña.putClientProperty("JComponent.roundRect", true);
        Contraseña.putClientProperty(FlatClientProperties.STYLE, "showRevealButton:true");

        /*try {
            javax.swing.UIManager.setLookAndFeel(javax.swing.UIManager.getSystemLookAndFeelClassName());
        } catch (Exception e) {
            e.printStackTrace();
        }*/
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btngGenero = new javax.swing.ButtonGroup();
        plBackground = new javax.swing.JPanel();
        lblNombrePantalla = new javax.swing.JLabel();
        lblMensaje1 = new javax.swing.JLabel();
        lblMensaje2 = new javax.swing.JLabel();
        lblMensaje3 = new javax.swing.JLabel();
        lblDoctoresImg = new javax.swing.JLabel();
        lblMensaje4 = new javax.swing.JLabel();
        btnIniciarSesion = new javax.swing.JButton();
        Logo = new javax.swing.JLabel();
        eslogan = new javax.swing.JLabel();
        lblGenero = new javax.swing.JLabel();
        rbtnFemenino = new javax.swing.JRadioButton();
        rbtnMasculino = new javax.swing.JRadioButton();
        btnRegistrarse = new javax.swing.JButton();
        lblSalir = new javax.swing.JLabel();
        Fondo = new javax.swing.JLabel();
        txtNombre = new javax.swing.JTextField();
        txtApellido = new javax.swing.JTextField();
        txtCorreo = new javax.swing.JTextField();
        txtTelefono = new javax.swing.JTextField();
        txtCedula = new javax.swing.JTextField();
        Contraseña = new javax.swing.JPasswordField();

        btngGenero.add(rbtnFemenino);
        btngGenero.add(rbtnMasculino);

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setMinimumSize(new java.awt.Dimension(930, 670));
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        plBackground.setBackground(new java.awt.Color(255, 255, 255));
        plBackground.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblNombrePantalla.setFont(new java.awt.Font("Dialog", 1, 32)); // NOI18N
        lblNombrePantalla.setForeground(new java.awt.Color(83, 121, 235));
        lblNombrePantalla.setText("Regístrate");
        plBackground.add(lblNombrePantalla, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 40, 190, 60));

        lblMensaje1.setFont(new java.awt.Font("Microsoft YaHei UI Light", 1, 35)); // NOI18N
        lblMensaje1.setForeground(new java.awt.Color(255, 255, 255));
        lblMensaje1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblMensaje1.setText("¡Crea tu cuenta!");
        plBackground.add(lblMensaje1, new org.netbeans.lib.awtextra.AbsoluteConstraints(600, 490, -1, 50));

        lblMensaje2.setFont(new java.awt.Font("Microsoft YaHei Light", 1, 18)); // NOI18N
        lblMensaje2.setForeground(new java.awt.Color(255, 255, 255));
        lblMensaje2.setText("y organiza citas eficientes");
        plBackground.add(lblMensaje2, new org.netbeans.lib.awtextra.AbsoluteConstraints(640, 520, 270, 50));

        lblMensaje3.setFont(new java.awt.Font("Microsoft YaHei Light", 1, 18)); // NOI18N
        lblMensaje3.setForeground(new java.awt.Color(255, 255, 255));
        lblMensaje3.setText("desde el primer momento.");
        plBackground.add(lblMensaje3, new org.netbeans.lib.awtextra.AbsoluteConstraints(640, 550, 290, 40));

        lblDoctoresImg.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Vista/imagenes/doctoresprueb.png"))); // NOI18N
        plBackground.add(lblDoctoresImg, new org.netbeans.lib.awtextra.AbsoluteConstraints(530, 210, 380, 250));

        lblMensaje4.setFont(new java.awt.Font("Dialog", 3, 12)); // NOI18N
        lblMensaje4.setForeground(new java.awt.Color(153, 153, 153));
        lblMensaje4.setText("¿Ya tienes una cuenta? ");
        plBackground.add(lblMensaje4, new org.netbeans.lib.awtextra.AbsoluteConstraints(150, 596, -1, 20));

        btnIniciarSesion.setBackground(new java.awt.Color(255, 255, 255));
        btnIniciarSesion.setFont(new java.awt.Font("Dialog", 1, 12)); // NOI18N
        btnIniciarSesion.setForeground(new java.awt.Color(59, 105, 240));
        btnIniciarSesion.setText(" Iniciar sesión");
        btnIniciarSesion.setBorder(null);
        btnIniciarSesion.setBorderPainted(false);
        btnIniciarSesion.setContentAreaFilled(false);
        btnIniciarSesion.setFocusable(false);
        btnIniciarSesion.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                btnIniciarSesionMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                btnIniciarSesionMouseExited(evt);
            }
        });
        btnIniciarSesion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIniciarSesionActionPerformed(evt);
            }
        });
        plBackground.add(btnIniciarSesion, new org.netbeans.lib.awtextra.AbsoluteConstraints(280, 590, 90, 30));

        Logo.setFont(new java.awt.Font("Segoe UI Emoji", 1, 55)); // NOI18N
        Logo.setForeground(new java.awt.Color(255, 255, 255));
        Logo.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        Logo.setText("SaludXpert");
        plBackground.add(Logo, new org.netbeans.lib.awtextra.AbsoluteConstraints(590, 140, -1, 70));

        eslogan.setFont(new java.awt.Font("Dialog", 3, 12)); // NOI18N
        eslogan.setForeground(new java.awt.Color(255, 255, 255));
        eslogan.setText("Citas rápidas, salud eficiente. ");
        plBackground.add(eslogan, new org.netbeans.lib.awtextra.AbsoluteConstraints(600, 160, -1, 70));

        lblGenero.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        lblGenero.setForeground(new java.awt.Color(102, 102, 102));
        lblGenero.setText("Género");
        plBackground.add(lblGenero, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 380, 120, 30));

        rbtnFemenino.setBackground(new java.awt.Color(255, 255, 255));
        rbtnFemenino.setFont(new java.awt.Font("Dialog", 1, 12)); // NOI18N
        rbtnFemenino.setForeground(new java.awt.Color(102, 102, 102));
        rbtnFemenino.setText("Femenino");
        rbtnFemenino.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbtnFemeninoActionPerformed(evt);
            }
        });
        plBackground.add(rbtnFemenino, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 410, 90, 40));

        rbtnMasculino.setBackground(new java.awt.Color(255, 255, 255));
        rbtnMasculino.setFont(new java.awt.Font("Dialog", 1, 12)); // NOI18N
        rbtnMasculino.setForeground(new java.awt.Color(102, 102, 102));
        rbtnMasculino.setText("Masculino");
        rbtnMasculino.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbtnMasculinoActionPerformed(evt);
            }
        });
        plBackground.add(rbtnMasculino, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 410, 90, 40));

        btnRegistrarse.setBackground(new java.awt.Color(204, 51, 255));
        btnRegistrarse.setFont(new java.awt.Font("Dialog", 1, 18)); // NOI18N
        btnRegistrarse.setForeground(new java.awt.Color(255, 255, 255));
        btnRegistrarse.setText("Registrarse");
        btnRegistrarse.setBorder(null);
        btnRegistrarse.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                btnRegistrarseMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                btnRegistrarseMouseExited(evt);
            }
        });
        btnRegistrarse.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRegistrarseActionPerformed(evt);
            }
        });
        plBackground.add(btnRegistrarse, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 520, 200, 60));

        lblSalir.setBackground(new java.awt.Color(164, 112, 231));
        lblSalir.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblSalir.setIcon(new FlatSVGIcon("Vista/imagenes/cerrar.svg"));
        lblSalir.setOpaque(true);
        lblSalir.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblSalirMouseClicked(evt);
            }
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                lblSalirMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                lblSalirMouseExited(evt);
            }
        });
        plBackground.add(lblSalir, new org.netbeans.lib.awtextra.AbsoluteConstraints(870, 10, 60, 50));

        Fondo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Vista/imagenes/fondo2.png"))); // NOI18N
        Fondo.setMaximumSize(new java.awt.Dimension(410, 670));
        Fondo.setMinimumSize(new java.awt.Dimension(410, 670));
        Fondo.setPreferredSize(new java.awt.Dimension(410, 670));
        plBackground.add(Fondo, new org.netbeans.lib.awtextra.AbsoluteConstraints(520, 0, 410, 680));
        plBackground.add(txtNombre, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 120, 210, 60));
        plBackground.add(txtApellido, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 120, 210, 60));
        plBackground.add(txtCorreo, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 210, 450, 60));
        plBackground.add(txtTelefono, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 300, 210, 60));
        plBackground.add(txtCedula, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 300, 210, 60));
        plBackground.add(Contraseña, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 390, 210, 60));

        getContentPane().add(plBackground, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, -10, 930, 680));

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void btnIniciarSesionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIniciarSesionActionPerformed

        PantallaInicioSesion inicio = new PantallaInicioSesion();
        inicio.setVisible(true);
        this.setVisible(false);
    }//GEN-LAST:event_btnIniciarSesionActionPerformed

    private void btnRegistrarseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRegistrarseActionPerformed

        Usuarios u = new Usuarios();
        ControladorUsuario control = new ControladorUsuario();
        DatabaseConnection con = new DatabaseConnection();

        String nombre = txtNombre.getText().trim();
        String apellido = txtApellido.getText().trim();
        String correo = txtCorreo.getText().trim();
        String numero_telefono = txtTelefono.getText().trim();
        String cedula = txtCedula.getText().trim();
        String contraseña = Contraseña.getText().trim();
        String genero = rbtnFemenino.isSelected() ? "Femenino" : "Masculino";
        
        if (!control.validarCampos(nombre, apellido, correo, numero_telefono, cedula, contraseña, genero)) {
            return;
        }
        //Esto se encarga de encriptar la contraseña
        String contraseñaEncriptada = BCrypt.hashpw(contraseña, BCrypt.gensalt());

        u.setNombre(nombre);
        u.setApellido(apellido);
        u.setCedula(cedula);
        u.setCorreo(correo);
        u.setGenero(genero);
        u.setNumeroTelefono(numero_telefono);
        u.setContraseña(contraseñaEncriptada);

        control.guardarUsuario(u);

    }//GEN-LAST:event_btnRegistrarseActionPerformed

    private void rbtnFemeninoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbtnFemeninoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_rbtnFemeninoActionPerformed

    private void btnIniciarSesionMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnIniciarSesionMouseEntered
        btnIniciarSesion.setForeground(new Color(0, 0, 153));
    }//GEN-LAST:event_btnIniciarSesionMouseEntered

    private void btnIniciarSesionMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnIniciarSesionMouseExited
        btnIniciarSesion.setForeground(new Color(59, 105, 240));
    }//GEN-LAST:event_btnIniciarSesionMouseExited

    private void btnRegistrarseMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnRegistrarseMouseExited
        btnRegistrarse.setBackground(new Color(204, 51, 255));
    }//GEN-LAST:event_btnRegistrarseMouseExited

    private void btnRegistrarseMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnRegistrarseMouseEntered
        btnRegistrarse.setBackground(new Color(153, 0, 153));
    }//GEN-LAST:event_btnRegistrarseMouseEntered

    private void lblSalirMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblSalirMouseEntered
        lblSalir.setBackground(new Color(255, 51, 102));
    }//GEN-LAST:event_lblSalirMouseEntered

    private void lblSalirMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblSalirMouseExited
        lblSalir.setBackground(new Color(164, 112, 231));
    }//GEN-LAST:event_lblSalirMouseExited

    private void lblSalirMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblSalirMouseClicked
        System.exit(0);
    }//GEN-LAST:event_lblSalirMouseClicked

    private void rbtnMasculinoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbtnMasculinoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_rbtnMasculinoActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        try {
            FlatLightLaf.setup();

            UIManager.put("Component.innerFocusWidth", 2);
            //UIManager.put("TextComponent.arc", 999);
        } catch (Exception ex) {
            System.err.println("No se pudo cargar el tema FlatLaf MacOS Light.");
            ex.printStackTrace();
        }
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new PantallaRegistrarse().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPasswordField Contraseña;
    private javax.swing.JLabel Fondo;
    private javax.swing.JLabel Logo;
    private javax.swing.JButton btnIniciarSesion;
    private javax.swing.JButton btnRegistrarse;
    private javax.swing.ButtonGroup btngGenero;
    private javax.swing.JLabel eslogan;
    private javax.swing.JLabel lblDoctoresImg;
    private javax.swing.JLabel lblGenero;
    private javax.swing.JLabel lblMensaje1;
    private javax.swing.JLabel lblMensaje2;
    private javax.swing.JLabel lblMensaje3;
    private javax.swing.JLabel lblMensaje4;
    private javax.swing.JLabel lblNombrePantalla;
    private javax.swing.JLabel lblSalir;
    private javax.swing.JPanel plBackground;
    private javax.swing.JRadioButton rbtnFemenino;
    private javax.swing.JRadioButton rbtnMasculino;
    private javax.swing.JTextField txtApellido;
    private javax.swing.JTextField txtCedula;
    private javax.swing.JTextField txtCorreo;
    private javax.swing.JTextField txtNombre;
    private javax.swing.JTextField txtTelefono;
    // End of variables declaration//GEN-END:variables
}
